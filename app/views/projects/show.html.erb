<% content_for(:page_title) do %>
  <% @page_title = "Project #{current_project.name}" %>
  <h1>

    Project <%= current_project.name %>
    <%= link_to image_tag('icons/buttons/edit.png', :border => '0', :title => "Edit Project"), edit_project_path(@project), :class => 'spaced' %>
    <%= link_to image_tag('icons/buttons/save.png', :border => '0', :title => "Clone Project"), clone_form_path(@project), :class => 'spaced' %>
    <%= link_to image_tag('icons/buttons/delete.png', :border => '0', :title => "Delete Project"), project_path(@project), :data => { :confirm => 'Are you sure?' }, :method => :delete, :class => 'spaced' %>
  </h1>
<% end %>

<% content_for(:breadcrumb) do %>
  <%= breadcrumb_box do %>
    <%= link_to "Projects", projects_path %>
    <span class="divider">&raquo;</span>
    <%= current_project.name %>
  <% end %>
<% end %>

<section>
  <div class="row-fluid">
    <div class="span5">
      <table class="table table-striped">
        <tbody>
          <tr>
            <th>Description</th>
            <td><%= @project.description %></td>
          </tr>
          <tr>
            <th>Project Type</th>
            <td><%= @project.template %></td>
          </tr>
          <tr>
            <th>Deployments</th>
            <td><%= @project.deployments.count %></td>
          </tr>
        </tbody>
      </table>

    </div>

    <div class="span4">
      <% if @project.stages.count > 0 %>
        <dl class="dl-horizontal">
          <dt>Choose a stage:</dt>
          <% for stage in @project.stages %>
            <dd><%= link_to stage.name, project_stage_path(@project, stage), :class => 'arrow_link'  %></dd>
          <% end %>
        </dl>
      <% else %>
        <p>No stage configured yet.</p>
        <% if current_user.admin? -%>
          <br/>
          <%= link_to 'New stage', new_project_stage_path(@project), class: "button-link" %>
        <%  end -%>
      <% end %>
    </div>
  </div>
</section>

<div>
  <section class="text-center">
    <h2>Project configuration</h2>
    <div>
      <%= render(:partial => 'configs')%>
    </div>
    <br/><br/>
    <%= link_to 'New configuration', new_project_project_configuration_path(@project), class: "button-link" %>
  </section>
</div>

<div>
  <section class="text-center">
    <h2>Users</h2>
    <%= render(:partial => 'users')%>
  </section>
</div>

<div>
  <section class="text-center">
    <h2>Stages</h2>
    <%= render(:partial => 'stages')%>
    <% if current_user.admin? -%>
      <br/><br/>
      <%= link_to 'New stage', new_project_stage_path(@project), class: "button-link" %>
    <%  end -%>
  </section>
</div>

<div>
  <section class="text-center">
    <h2>Recent Deployments</h2>
    <%= render(:partial => 'deployments')%>
    <br />
  </section>
</div>

<div>
  <section class="text-center">
    <h2>Recent Activities</h2>
    <%= render partial: 'activities/list', locals: { activities: @project.activities } %>
    <br />
  </section>
</div>
